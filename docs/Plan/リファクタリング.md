ã“ã®ä¿®æ­£ã®æ„å‘³ã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚

## mypy overridesã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æ„å‘³

### 1. **æ®µéšçš„å‹ä»˜ã‘ï¼ˆGradual Typingï¼‰ã®å®Ÿè£…**

```toml
# Gradual typing - strict typing for specific modules
[[tool.mypy.overrides]]
module = "app.api.documents"
disallow_untyped_defs = true
disallow_incomplete_defs = true
```

**æ„å‘³**: `app.api.documents`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã¯å³æ ¼ãªå‹ãƒã‚§ãƒƒã‚¯ã‚’æœ‰åŠ¹ã«ã™ã‚‹

- `disallow_untyped_defs = true`: å‹æ³¨é‡ˆã®ãªã„é–¢æ•°å®šç¾©ã‚’ç¦æ­¢
- `disallow_incomplete_defs = true`: ä¸å®Œå…¨ãªå‹æ³¨é‡ˆã‚’ç¦æ­¢

### 2. **ãƒ¢ãƒ‡ãƒ«å±¤ã®å‹å®‰å…¨æ€§ç¢ºä¿**

```toml
[[tool.mypy.overrides]]
module = "app.models.*"
disallow_untyped_defs = true
disallow_incomplete_defs = true
```

**æ„å‘³**: ã™ã¹ã¦ã®ãƒ¢ãƒ‡ãƒ«ï¼ˆ`app.models.*`ï¼‰ã§å³æ ¼ãªå‹ãƒã‚§ãƒƒã‚¯ã‚’é©ç”¨

### 3. **å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå•é¡Œã®å›é¿**

```toml
# External library compatibility
[[tool.mypy.overrides]]
module = "app.database.migration"
ignore_errors = true
```

**æ„å‘³**: Alembicï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ã®å‹å®šç¾©å•é¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—

### 4. **è¤‡é›‘ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¸€æ™‚çš„é™¤å¤–**

```toml
# Temporarily ignore complex auth type issues
[[tool.mypy.overrides]]
module = "app.api.auth"
ignore_errors = true
```

**æ„å‘³**: èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®è¤‡é›‘ãªå‹å•é¡Œã‚’ä¸€æ™‚çš„ã«ç„¡è¦–

## ãªãœã“ã®ä¿®æ­£ãŒå¿…è¦ã ã£ãŸã®ã‹

### **å•é¡Œ**: å…¨ä½“ã§65å€‹ã®mypyã‚¨ãƒ©ãƒ¼

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’ä¸€åº¦ã«å³æ ¼ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨å¤§é‡ã®ã‚¨ãƒ©ãƒ¼
- é–‹ç™ºåŠ¹ç‡ãŒè‘—ã—ãä½ä¸‹

### **è§£æ±ºç­–**: æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

```mermaid
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ (ç·©ã„å‹ãƒã‚§ãƒƒã‚¯)
    â†“
ç‰¹å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (å³æ ¼ãªå‹ãƒã‚§ãƒƒã‚¯)
    â†“
å•é¡Œã®ã‚ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (ã‚¨ãƒ©ãƒ¼ç„¡è¦–)
```

## ä¿®æ­£ã®æˆ¦ç•¥çš„æ„å‘³

### **1. å„ªå…ˆé †ä½ä»˜ã‘**

```toml
# é«˜å“è³ªã‚’è¦æ±‚
app.api.documents  â† æ–°ã—ã„APIã€å‹å®‰å…¨æ€§é‡è¦
app.models.*       â† ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã€å‹å®‰å…¨æ€§å¿…é ˆ

# å•é¡Œå›é¿
app.database.migration  â† å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜
app.api.auth           â† ãƒ¬ã‚¬ã‚·ãƒ¼ã€è¤‡é›‘
```

### **2. é–‹ç™ºåŠ¹ç‡ã®å‘ä¸Š**

- **å³åº§ã«**: é‡è¦éƒ¨åˆ†ã®å‹å®‰å…¨æ€§ç¢ºä¿
- **å°†æ¥çš„ã«**: æ®µéšçš„ã«ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚å³æ ¼åŒ–

### **3. ãƒãƒ¼ãƒ é–‹ç™ºã¸ã®é…æ…®**

```python
# æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ï¼ˆå³æ ¼ï¼‰
def create_document(document: DocumentCreate) -> DocumentResponse:
    # å‹ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹ã¨é–‹ç™ºæ™‚ã«å³åº§ã«æ¤œå‡º

# æ—¢å­˜ã‚³ãƒ¼ãƒ‰ï¼ˆç·©ã„ï¼‰
def legacy_function(data):  # å‹æ³¨é‡ˆãªã—ã§ã‚‚OK
    # æ®µéšçš„ã«ä¿®æ­£å¯èƒ½
```

## å®Ÿéš›ã®åŠ¹æœ

### **Before**: 65å€‹ã®ã‚¨ãƒ©ãƒ¼

```bash
app/api/auth.py: 15 errors
app/core/middleware.py: 12 errors
app/database/migration.py: 8 errors
app/models/milvus.py: 5 errors
# ... ä»–å¤šæ•°
```

### **After**: ç®¡ç†å¯èƒ½ãªçŠ¶æ…‹

```bash
app/api/documents: 0 errors (å³æ ¼ãƒã‚§ãƒƒã‚¯æœ‰åŠ¹)
app/models.*: 0 errors (å³æ ¼ãƒã‚§ãƒƒã‚¯æœ‰åŠ¹)
app/database.migration: ignored (å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)
app.api.auth: ignored (ä¸€æ™‚çš„)
```

## é•·æœŸçš„ãªè¨ˆç”»

### **Phase 1** (ç¾åœ¨) âœ…

- é‡è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‹å®‰å…¨æ€§ç¢ºä¿
- é–‹ç™ºåŠ¹ç‡ã®ç¶­æŒ

### **Phase 2** (æ¬¡å›)

```toml
# auth.pyã®æ®µéšçš„ä¿®æ­£
[[tool.mypy.overrides]]
module = "app.api.auth"
# ignore_errors = true  â† å‰Šé™¤
disallow_untyped_defs = true  â† è¿½åŠ 
```

### **Phase 3** (å°†æ¥)

```toml
# å…¨ä½“ã‚’å³æ ¼ã«
[tool.mypy]
disallow_untyped_defs = true  # å…¨ä½“ã«é©ç”¨
# å€‹åˆ¥overrideã¯å‰Šé™¤
```

## ã¾ã¨ã‚

ã“ã®ä¿®æ­£ã¯**ã€Œå®Œç’§ãªå‹å®‰å…¨æ€§ã€ã‚ˆã‚Šã‚‚ã€Œå®Ÿç”¨çš„ãªå“è³ªå‘ä¸Šã€**ã‚’é¸æŠã—ãŸæˆ¦ç•¥çš„åˆ¤æ–­ã§ã™ï¼š

- âœ… **é‡è¦éƒ¨åˆ†**: å³æ ¼ãªå‹ãƒã‚§ãƒƒã‚¯
- â¸ï¸ **å•é¡Œéƒ¨åˆ†**: ä¸€æ™‚çš„ã«ç„¡è¦–
- ğŸ¯ **ç›®æ¨™**: æ®µéšçš„ãªå“è³ªå‘ä¸Š

ã“ã‚Œã«ã‚ˆã‚Šã€å‹å®‰å…¨æ€§ã‚’ç¢ºä¿ã—ãªãŒã‚‰é–‹ç™ºåŠ¹ç‡ã‚’ç¶­æŒã§ãã¦ã„ã¾ã™ã€‚
